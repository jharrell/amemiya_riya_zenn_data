---
title: 'C++の負債とCarbon'
emoji: '🔖'
type: 'tech' # tech: 技術記事 / idea: アイデア
topics: ['carbon', 'cpp']
published: true
---

## はじめに

修正や追加等はコメントまたは GitHub で編集リクエストをお待ちしております。

:::message alert
私は専門家ではなくアマチュアなので間違え等ありましたらコメントお願いいたします。
:::

## 本題

最近 Google が発表した Carbon と言う言語をご存知でしょうか？
これは C++を改善するために生まれた言語です。
ですが Rust や Zig みたいに全て書き換える必要は無いです。
TypeScript と JavaScript のように相互に運用できる言語設計（になる予定）です。
では何故 Carbon が必要だったのでしょうか？
Carbon は生き残れるのでしょうか?
C++を知ることで、Carbon を使う理由が見えてくると思います。

## C++で作られた or 依存しているもの

(間接的なもの含む)

- V8
- Windows
- Mac
- Linux
- Python
- LLVM
- Swift
- Ruby
- Adobe 製品
- Microsoft Office
- JVM

ご覧ください
プログラミングの根幹を支えているのは C++です。
人類は C++に依存しています。

## C++の欠点

:::message alert
個人的意見、思想です。
:::

### 構文がかけ離れすぎてる

C が生まれたの約半世紀前
一方今使われている C 以外の言語は 10~20 年前ぐらいに生まれました。
1983 年(39 年前)に生まれた C++は現代のプログラミング言語とは全く別の構文を持っています。
例えば以下のようなプログラムがあります。

```cpp:C++
#include <iostream>
int main() {
    int age = 18;
    std::cout << "I am " << age << " years old." << std::endl;
    return 0;
}
```

```rust:Rust
fn main() {
    let age = 18;
    println!("I am {} years old.", age);
}
```

```javascript:JavaScript
function main() {
    let age = 18;
    console.log("I am " + age + " years old.");
}
main();
```

```python:Python
def main():
    age = 18
    print("I am " + age + " years old.")

if __name__ == "__main__":
    main()
```

C++を見てください。
print,printf,console.log のどれでもなく std::cout とかいう意味わからん言葉です。
(cout は character output(文字出力)の略らしいです)
構文も `()` ではなく `<<` を使う特殊な構文です。

### メモリを自分で管理しないといけない

C/C++のメモリ管理はプログラマーの責任です。
自分で管理できるので自由度が高い反面考慮しなければいけないことが増えます。

```cpp:C++
#include <iostream>
int main(int argc, const char **argv)
{
    char *name = new char[32];
    memset(name, 0, 33);//オーバーフロー
    return 0;
}
```

上記コードのようにメモリ操作で思わぬオーバーフローを起こすことがあります。
コンパイラは上記コードでは何の警告もしません。
自由と責任が常に C/C++に付きまといます。

### C 互換ではない

C 言語と C++は混在して書けるので互換性があると思いがちですがそうではないです。
簡単な例を挙げるとすれば `auto` です。
C の `auto` はローカル変数の意味で型を省略すると `int` で解釈されます。
C++の `auto` は型推論で解釈されます。
したがって下記のようなコードは C と C++で違いがでます。

```cpp:C++
#include <iostream>
int main(int argc, const char **argv)
{
    auto age = 9.5;
    std::cout << "I am " << age * 2 << " years old." << std::endl;
    return 0;
}
```

```c:C
#include <stdio.h>
int main(int argc, const char **argv)
{
    auto age = 9.5;//int型なので0.5は切り捨て
    printf("I am %f years old.\n", age * 2);// 18になる
    return 0;
}
```

## Rust と Carbon どっち？

Rust は C/C++の代わりになることを目的としています。
メモリ安全なコードを簡単に書けるのに C/C++とほぼ同等な速度を持っています。
ですが独特で難解な構文があり、人類には少し早すぎます。
Carbon のサイトには。

```text
If you can use Rust, ignore Carbon(もしRustが使えるなら、Carbonは無視して)
```

とあるので Rust が書ける強強マンには Carbon は無用です。
C++は書けるけど Rust は無理だなーって人向けの言語が Carbon です。

## まとめ

まだまだ赤ちゃんの Carbon の今後の成長が楽しみです。
個人的には V8 などで Carbon が採用されたら一気に注目されると思います。
